!function(t){var e={};function r(s){if(e[s])return e[s].exports;var i=e[s]={i:s,l:!1,exports:{}};return t[s].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=t,r.c=e,r.d=function(t,e,s){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(r.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(s,i,function(e){return t[e]}.bind(null,i));return s},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=18)}([function(t,e){t.exports=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},t.exports.__esModule=!0,t.exports.default=t.exports},function(t,e,r){var s=r(14);function i(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,s(i.key),i)}}t.exports=function(t,e,r){return e&&i(t.prototype,e),r&&i(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t},t.exports.__esModule=!0,t.exports.default=t.exports},,,function(t,e){function r(e){return t.exports=r=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},t.exports.__esModule=!0,t.exports.default=t.exports,r(e)}t.exports=r,t.exports.__esModule=!0,t.exports.default=t.exports},function(t,e){function r(e){return t.exports=r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t.exports.__esModule=!0,t.exports.default=t.exports,r(e)}t.exports=r,t.exports.__esModule=!0,t.exports.default=t.exports},function(t,e){t.exports=function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t},t.exports.__esModule=!0,t.exports.default=t.exports},function(t,e){function r(e,s){return t.exports=r=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},t.exports.__esModule=!0,t.exports.default=t.exports,r(e,s)}t.exports=r,t.exports.__esModule=!0,t.exports.default=t.exports},function(t,e,r){var s=r(7);t.exports=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&s(t,e)},t.exports.__esModule=!0,t.exports.default=t.exports},function(t,e,r){var s=r(5).default,i=r(6);t.exports=function(t,e){if(e&&("object"===s(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return i(t)},t.exports.__esModule=!0,t.exports.default=t.exports},function(t,e,r){var s=r(4),i=r(7),n=r(11),o=r(12);function a(e){var r="function"==typeof Map?new Map:void 0;return t.exports=a=function(t){if(null===t||!n(t))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==r){if(r.has(t))return r.get(t);r.set(t,e)}function e(){return o(t,arguments,s(this).constructor)}return e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),i(e,t)},t.exports.__esModule=!0,t.exports.default=t.exports,a(e)}t.exports=a,t.exports.__esModule=!0,t.exports.default=t.exports},function(t,e){t.exports=function(t){return-1!==Function.toString.call(t).indexOf("[native code]")},t.exports.__esModule=!0,t.exports.default=t.exports},function(t,e,r){var s=r(7),i=r(13);function n(e,r,o){return i()?(t.exports=n=Reflect.construct.bind(),t.exports.__esModule=!0,t.exports.default=t.exports):(t.exports=n=function(t,e,r){var i=[null];i.push.apply(i,e);var n=new(Function.bind.apply(t,i));return r&&s(n,r.prototype),n},t.exports.__esModule=!0,t.exports.default=t.exports),n.apply(null,arguments)}t.exports=n,t.exports.__esModule=!0,t.exports.default=t.exports},function(t,e){t.exports=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}},t.exports.__esModule=!0,t.exports.default=t.exports},function(t,e,r){var s=r(5).default,i=r(15);t.exports=function(t){var e=i(t,"string");return"symbol"===s(e)?e:String(e)},t.exports.__esModule=!0,t.exports.default=t.exports},function(t,e,r){var s=r(5).default;t.exports=function(t,e){if("object"!==s(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var i=r.call(t,e||"default");if("object"!==s(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)},t.exports.__esModule=!0,t.exports.default=t.exports},,,function(t,e,r){"use strict";r.r(e);var s=r(6),i=r.n(s),n=r(8),o=r.n(n),a=r(9),u=r.n(a),h=r(4),f=r.n(h),c=r(10),l=r.n(c),p=r(0),_=r.n(p),A=r(1),E=r.n(A);function S(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,s=f()(t);if(e){var i=f()(this).constructor;r=Reflect.construct(s,arguments,i)}else r=s.apply(this,arguments);return u()(this,r)}}var d=!1,b=function(){function t(){_()(this,t),this.cacheSize=0,this.sameCacheSizeCounter=0}return E()(t,[{key:"shouldSendCacheSize",value:function(t){return t===this.cacheSize&&this.sameCacheSizeCounter++,(this.cacheSize!==t||200===this.sameCacheSizeCounter)&&(this.sameCacheSizeCounter=0,this.cacheSize=t,!0)}}]),t}(),T=1,y=function(){function t(e,r,s){if(_()(this,t),this.STATE_READ_READY=0,this.STATE_READ_INDEX=1,this.STATE_WRITE_READY=2,this.STATE_WRITE_INDEX=3,this.STATE_DATA_COUNT=4,this.STATE_CACHE_SIZE=5,this.STATY_READY_NO=0,this.STATY_READY_YES=1,this.sabState=new Uint32Array(e),this.sabBuffer=new Float32Array(r),this.perFrameLength=s,this.bufferLen=this.sabBuffer.length,this.supportSpecialOptimization=this.bufferLen%s==0,this.bufferIndex=null,this.supportSpecialOptimization){var i=this.bufferLen/s;this.bufferIndex=[];for(var n=0;n<i;n++)this.bufferIndex.push(this.sabBuffer.subarray(n*s,n*s+s))}this.placeBuffer=new Float32Array(this.perFrameLength),this.QUANTUM_SIZE=128,this.CACHE_SIZE_MAX_VALUE=Math.floor(Math.floor(this.bufferLen/this.QUANTUM_SIZE)/2),this.CACHE_SIZE_MIN_VALUE=6,this.CACHE_SIZE_MAX_VALUE<this.CACHE_SIZE_MIN_VALUE&&(this.CACHE_SIZE_MAX_VALUE=this.CACHE_SIZE_MIN_VALUE),this.setCacheSize(this.CACHE_SIZE_MIN_VALUE),this._counter=0,this.onCacheSizeChange=null,this.cacheSizeController=new b}return E()(t,[{key:"getCacheSize",value:function(){return Atomics.load(this.sabState,this.STATE_CACHE_SIZE)}},{key:"setCacheSize",value:function(t){t>this.CACHE_SIZE_MAX_VALUE&&(t=this.CACHE_SIZE_MAX_VALUE),t<this.CACHE_SIZE_MIN_VALUE&&(t=this.CACHE_SIZE_MIN_VALUE),this.onCacheSizeChange&&this.cacheSizeController.shouldSendCacheSize(t)&&this.onCacheSizeChange(t),Atomics.store(this.sabState,this.STATE_CACHE_SIZE,t)}},{key:"setQuantumSize",value:function(t){this.QUANTUM_SIZE=t,this.CACHE_SIZE_MAX_VALUE=Math.floor(Math.floor(this.bufferLen/this.QUANTUM_SIZE)/2),this.CACHE_SIZE_MAX_VALUE<this.CACHE_SIZE_MIN_VALUE&&(this.CACHE_SIZE_MAX_VALUE=this.CACHE_SIZE_MIN_VALUE)}},{key:"isNeedMoreData",value:function(){var t=Atomics.load(this.sabState,this.STATE_CACHE_SIZE);return Atomics.load(this.sabState,this.STATE_DATA_COUNT)<t*this.QUANTUM_SIZE}},{key:"shouldAdjustCacheBuffer",value:function(){this._counter>0&&this.setCacheSize(this.getCacheSize()+1)}},{key:"clear",value:function(){this.sabState&&(this.sabState[this.STATE_READ_READY]=0,this.sabState[this.STATE_READ_INDEX]=0,this.sabState[this.STATE_WRITE_READY]=0,this.sabState[this.STATE_WRITE_INDEX]=0,this.sabState[this.STATE_DATA_COUNT]=0),this._counter=0}},{key:"setWriteReady",value:function(){this.sabState[this.STATE_WRITE_READY]=this.STATY_READY_YES}},{key:"isReady",value:function(){return this.sabState[this.STATE_WRITE_READY]&&this.sabState[this.STATE_READ_READY]}},{key:"getDataCount",value:function(){return Atomics.load(this.sabState,this.STATE_DATA_COUNT)}},{key:"write",value:function(t){if(t[0].length*T===this.perFrameLength){var e=this.sabState[this.STATE_READ_READY];if(this.sabState[this.STATE_WRITE_READY]||(this.sabState[this.STATE_WRITE_READY]=this.STATY_READY_YES,this.sabState[this.STATE_WRITE_INDEX]=0),e)return this.supportSpecialOptimization?this.writeSpecial(t):this.writeNormal(t)}}},{key:"writeNormal",value:function(t){for(var e=this.sabState[this.STATE_WRITE_INDEX],r=0;r<T;r++)for(var s=0;t[r]&&s<t[r].length;s++)this.sabBuffer[(e+s*T+r)%this.bufferLen]=t[r][s];(e+=this.perFrameLength)>=this.bufferLen&&(e-=this.bufferLen),this.sabState[this.STATE_WRITE_INDEX]=e,Atomics.add(this.sabState,this.STATE_DATA_COUNT,this.perFrameLength)}},{key:"writeSpecial",value:function(t){for(var e=this.sabState[this.STATE_WRITE_INDEX],r=0;r<T;r++)for(var s=0;t[r]&&s<t[r].length;s++)this.bufferIndex[e][s*T+r]=t[r][s];e=(e+1)%this.bufferIndex.length,this.sabState[this.STATE_WRITE_INDEX]=e,Atomics.add(this.sabState,this.STATE_DATA_COUNT,this.perFrameLength)}},{key:"read",value:function(){var t=this.sabState[this.STATE_READ_READY],e=this.sabState[this.STATE_WRITE_READY];if(t||(this.sabState[this.STATE_READ_READY]=this.STATY_READY_YES,this.sabState[this.STATE_READ_INDEX]=0),!e)return null;var r=this.supportSpecialOptimization?this.readSpecial():this.readNormal();return null===r?this.shouldAdjustCacheBuffer():this._counter++,r}},{key:"readNormal",value:function(){var t=this.sabState[this.STATE_READ_INDEX],e=Atomics.load(this.sabState,this.STATE_DATA_COUNT);if(e<this.perFrameLength)return null;if(e>this.bufferLen){var r=Math.ceil((e-this.bufferLen)/this.perFrameLength)+1;t=(r*this.perFrameLength+t)%this.bufferLen,Atomics.sub(this.sabState,this.STATE_DATA_COUNT,r*this.perFrameLength)}var s=null;if(this.bufferLen-t>=this.perFrameLength)s=this.sabBuffer.subarray(t,t+this.perFrameLength);else{var i=this.sabBuffer.subarray(t),n=this.sabBuffer.subarray(0,this.perFrameLength-i.length);(s=this.placeBuffer).set(i),s.set(n,i.length)}return(t+=this.perFrameLength)>=this.bufferLen&&(t-=this.bufferLen),this.sabState[this.STATE_READ_INDEX]=t,Atomics.sub(this.sabState,this.STATE_DATA_COUNT,this.perFrameLength),s}},{key:"readSpecial",value:function(){var t=this.sabState[this.STATE_READ_INDEX],e=Atomics.load(this.sabState,this.STATE_DATA_COUNT);if(e<this.perFrameLength)return null;if(e>this.bufferLen){var r=Math.ceil((e-this.bufferLen)/this.perFrameLength)+1;t=(r+t)%this.bufferIndex.length,Atomics.sub(this.sabState,this.STATE_DATA_COUNT,r*this.perFrameLength)}var s=this.bufferIndex[t];return t=(t+1)%this.bufferIndex.length,this.sabState[this.STATE_READ_INDEX]=t,Atomics.sub(this.sabState,this.STATE_DATA_COUNT,this.perFrameLength),s}}]),t}(),x="undefined"!=typeof SharedArrayBuffer,m=function(t){o()(r,t);var e=S(r);function r(t){var s;return _()(this,r),(s=e.call(this)).port.onmessage=s.handleMessage.bind(i()(s)),s.isPlaying=!1,s.isCapturing=!1,s.audioEncodePort=null,t&&t.processorOptions&&t.processorOptions.sharingEncodeChannelsNum&&(T=t.processorOptions.sharingEncodeChannelsNum),s}return E()(r,[{key:"handleMessage",value:function(t){var e=t.data,r=e.status,s=e.data;switch(r){case"StartCaptureAudio":this.isCapturing=!0;break;case"sampleRate":this.sampleRate_=s;break;case"encodeAudioPort":this.audioEncodePort&&this.audioEncodePort.close(),this.audioEncodePort=t.ports[0];break;case"stopWorklet":d=!0;break;default:x?this.handleMessageForSAB(t):console.warn("unhanle commands in audioworklet",r)}}},{key:"handleMessageForSAB",value:function(t){var e=t.data,r=e.status,s=e.data;switch(r){case"sharedBuffer":s&&(this.g_sharedbuffer=s),this.g_sharedbuffer&&(this.sharingSAB=new y(this.g_sharedbuffer.sharingInputState,this.g_sharedbuffer.sharingInputBuffer,128*T));break;default:console.warn("unhanle commands in audioworklet",r)}}},{key:"process",value:function(t,e,r){return!d&&(!!x&&this.SABProcess(t,r))}},{key:"inputData",value:function(t){if(!this.sharingSAB)return!0;this.sharingSAB.write(t[0]),this.audioEncodePort.postMessage({command:2,buffer:!1})}},{key:"SABProcess",value:function(t,e){var r=t[0];return!this.g_sharedbuffer||(r[0]&&this.isCapturing&&this.inputData(t),!0)}}],[{key:"parameterDescriptors",get:function(){return[{name:"pcm",defaultValue:1}]}}]),r}(l()(AudioWorkletProcessor));registerProcessor("zoomSharingAudioWorklet",m)}]);
//# sourceMappingURL=https://d1cdksi819e9z7.cloudfront.net/sourcemap/js_sharing_audio_worklet.min.js-7fae56967830095ca966.map